---
title: "sisbidDay2_code"
author: "Angie Boysen"
date: "July 12, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```

Installing google sheets
```{r install}
# install.packages('googlesheets')
#library(devtools)
#install_github("jennybc/googlesheets")
library(googlesheets)
```

Reading a google sheet
```{r firstread}
sheets_url = "https://docs.google.com/spreadsheets/d/18KQQd4LY5k8Ucux1MvWCsQGQJlvd0ECTnn-3ixdOKFM/pubhtml"

gsurl1 = gs_url(sheets_url)
dat = gs_read(gsurl1)
date_accessed = date()

```

Doing the lab
```{r gslabImport}
sheets_url <- "https://docs.google.com/spreadsheets/d/103vUoftv2dLNZ_FcAz08b5ptIkWN4W2RaFn7VF39FJ8/pubhtml"
gsurl1 = gs_url(sheets_url)
dat = gs_read(gsurl1)

#read just the forst two rows
dat2cols <- gs_read(gsurl1, range = cell_cols(1:2))
```

How many students have entered data? 
``` {r gslabstudentCount}
dat2cols <- dat2cols[!is.na(dat2cols$UW),]
nStudents <- nrow(dat2cols)
nStudents
```

Do students have more than 2 years of experience with R?
```{r yearsofR}
#This way of doing it introduces NAs b/c some folks didn't enter just a number
dat$twoyears <- as.numeric(dat$`Years of R experience`)>2

```

Didn't finish the factor part
```{r factors}
# create factor "skilled" and "learning"
factorYears <- NULL
```


## doing JSON stuff now
load lib/install stuff
```{r installJSON}
# install.packages("jsonlite")
library(jsonlite)

github_url = "https://api.github.com/users/jtleek/repos"
jsonData <- fromJSON(github_url)
dim(jsonData)
names(jsonData)
```

exploring data -- 
JSON is super flexible. COlumns can have nested structure in them.
```{r exploring}
## Test whether there are nested dataframes
table(sapply(jsonData, class))
dim(jsonData$owner)
names(jsonData$owner)
```


JSON lab
```{r JSONlab}
github_url = "https://api.github.com/users/hadley/repos"
hadleyData <- fromJSON(github_url)
names(hadleyData)

##number of stars
hadleyData$stargazers_count

##number of open issues
hadleyData$open_issues
```

## Web scraping
With rvest package
Identify the URL you want to scrape
```{r webscraping1}
recount_url = "http://bowtie-bio.sourceforge.net/recount/"
# install.packages("rvest")
library(rvest)
htmlfile = read_html(recount_url)
```

We just want the table from that URL. Use the xpath for that data.
``` {r justthesubset}
nds = html_nodes(htmlfile, xpath='//*[@id="recounttab"]/table')
dat = html_table(nds)
dat = as.data.frame(dat)
head(dat)
names(dat) <- dat[1,]
dat <- dat[-1,]
head(dat)
```

